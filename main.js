/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var I=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var N=(p,c)=>()=>(p&&(c=p(p=0)),c);var U=(p,c)=>{for(var t in c)I(p,t,{get:c[t],enumerable:!0})},J=(p,c,t,e)=>{if(c&&typeof c=="object"||typeof c=="function")for(let s of q(c))!Y.call(p,s)&&s!==t&&I(p,s,{get:()=>c[s],enumerable:!(e=z(c,s))||e.enumerable});return p};var X=p=>J(I({},"__esModule",{value:!0}),p);async function k(p){let c=p.app.vault,t=p.settings.patterns.map(s=>new RegExp(s,"g")),e=[];for(let s of c.getMarkdownFiles())(await c.cachedRead(s)).split(`
`).forEach((i,n)=>{t.forEach(l=>{var h;for(let u of i.matchAll(l))e.push({file:s,line:n,col:(h=u.index)!=null?h:0,text:u[0]})})});return e}var V=N(()=>{});async function F(p){let c=new TextEncoder,t=await crypto.subtle.importKey("raw",c.encode(p),{name:"PBKDF2"},!1,["deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:c.encode("pii-salt"),iterations:5e4,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function $(p,c){let t=crypto.getRandomValues(new Uint8Array(12)),e=await F(c),s=new TextEncoder().encode(p),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,s);return`${Buffer.from(t).toString("base64")}.${Buffer.from(a).toString("base64")}`}async function _(p,c){let[t,e]=p.split("."),s=Uint8Array.from(Buffer.from(t,"base64")),a=Buffer.from(e,"base64"),o=await F(c),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},o,a);return new TextDecoder().decode(i)}var W=N(()=>{});var j={};U(j,{PiiSidebarView:()=>S,PwModal:()=>A,VIEW_TYPE_PII:()=>b});var m,b,Q,tt,B,A,S,R=N(()=>{m=require("obsidian");V();W();b="pii-sidebar-view",Q=5e3,tt=3e3,B=()=>{var p,c;return(c=(p=crypto.randomUUID)==null?void 0:p.call(crypto))!=null?c:Date.now().toString(36)+Math.random().toString(36).slice(2,10)},A=class extends m.Modal{constructor(t,e,s=!1){super(t);this.title=e;this.isEncrypt=s}onOpen(){let{containerEl:t}=this;t.empty(),t.addClass("pii-modal");let e=t.createDiv({cls:"pii-modal-content"}),s=e.createEl("h3",{cls:"pii-modal-title"}),a=this.isEncrypt?"\u{1F512}":"\u{1F513}";s.innerHTML=`${a} ${this.title}`;let o=this.isEncrypt?"Enter a password to encrypt your sensitive information. Remember this password as you'll need it to decrypt later.":"Enter your password to decrypt the protected information.";e.createEl("p",{text:o,cls:"pii-modal-description"});let i="",n=!1,l=e.createDiv({cls:"pii-modal-form"}),h=l.createDiv({cls:"pii-password-container"});h.createEl("label",{text:"Password",cls:"pii-input-label"});let u=h.createDiv({cls:"pii-input-wrapper"}),w=u.createEl("input",{type:"password",placeholder:this.isEncrypt?"Create a strong password":"Enter your password",cls:"pii-password-input"});w.addEventListener("input",f=>{i=f.target.value}),w.focus(),w.addEventListener("keydown",f=>{f.key==="Enter"&&(this.isEncrypt?this.validateAndSubmit(i,r):this.submit(i))});let C=u.createEl("button",{cls:"pii-password-toggle",text:"\u{1F441}\uFE0F"});C.addEventListener("click",f=>{f.preventDefault(),n=!n,w.type=n?"text":"password",C.textContent=n?"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":"\u{1F441}\uFE0F"});let r="",d=null;if(this.isEncrypt){let f=l.createDiv({cls:"pii-password-container"});f.createEl("label",{text:"Confirm Password",cls:"pii-input-label"});let P=f.createDiv({cls:"pii-input-wrapper"});d=P.createEl("input",{type:"password",placeholder:"Confirm your password",cls:"pii-password-input"}),d.addEventListener("input",M=>{r=M.target.value}),d.addEventListener("keydown",M=>{M.key==="Enter"&&this.validateAndSubmit(i,r)});let O=P.createEl("button",{cls:"pii-password-toggle",text:"\u{1F441}\uFE0F"});O.addEventListener("click",M=>{M.preventDefault(),n=!n,d&&(d.type=n?"text":"password"),O.textContent=n?"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":"\u{1F441}\uFE0F",w.type=n?"text":"password",C.textContent=n?"\u{1F441}\uFE0F\u200D\u{1F5E8}\uFE0F":"\u{1F441}\uFE0F"})}let y=e.createDiv({cls:"pii-modal-buttons"}),E=y.createEl("button",{text:"Cancel",cls:"pii-btn-secondary"});E.onclick=()=>this.close();let x=this.isEncrypt?"Encrypt":"Decrypt",g=y.createEl("button",{text:x,cls:"pii-btn-primary"});g.onclick=()=>{this.isEncrypt?this.validateAndSubmit(i,r):this.submit(i)}}validateAndSubmit(t,e){if(!t){new m.Notice("Please enter a password");return}if(this.isEncrypt&&t!==e){new m.Notice("Passwords do not match");return}this.submit(t)}submit(t){this.close(),this._resolve(t||null)}onClose(){this.contentEl.empty()}wait(){return this.open(),new Promise(t=>this._resolve=t)}},S=class extends m.ItemView{constructor(t,e){super(t);this.plugin=e;this.matches=[];this.searchResults=[];this.manualSelections=[];this.selected=new Set;this.cachedPassword=null;this.currentMode="scan";this.boundHandleTextSelection=this.handleTextSelection.bind(this);this.boundHandleDragStart=this.handleDragStart.bind(this)}getViewType(){return b}getDisplayText(){return"Lock and Find"}getIcon(){return"shield"}async onOpen(){let t=this.containerEl;t.empty(),this.setupTextSelectionDragDrop();let e=t.createEl("div",{cls:"pii-mode-toggle"}),s=e.createEl("button",{cls:this.currentMode==="scan"?"pii-btn-primary":"pii-btn-secondary",text:"Scan Mode"}),a=e.createEl("button",{cls:this.currentMode==="search"?"pii-btn-primary":"pii-btn-secondary",text:"Search Mode"});s.onclick=()=>{this.currentMode="scan",s.className="pii-btn-primary",a.className="pii-btn-secondary",this.render()},a.onclick=()=>{this.currentMode="search",s.className="pii-btn-secondary",a.className="pii-btn-primary",this.render()};let o=t.createEl("div",{cls:"pii-scan-controls"}),i=o.createEl("button",{cls:"pii-btn-primary pii-btn-half"});i.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M5,3H19C20.11,3 21,3.89 21,5V13.03C20.5,12.23 19.81,11.54 19,11V5H5V19H9.5C9.81,19.75 10.26,20.42 10.81,21H5C3.89,21 3,20.11 3,19V5C3,3.89 3.89,3 5,3M7,7H17V9H7V7M7,11H12.03C11.23,11.5 10.54,12.19 10,13H7V11M7,15H9.17C9.06,15.5 9,16 9,16.5V17H7V15Z"></path></svg> Scan Vault';let n=o.createEl("button",{cls:"pii-btn-secondary pii-btn-half"});n.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"></path></svg> Clear',i.onclick=async()=>{i.disabled=!0,i.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"><animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="1s" from="0 12 12" to="360 12 12" repeatCount="indefinite" /></path></svg> Scanning...',this.matches=await k(this.plugin),this.selected.clear(),this.render(),i.disabled=!1,i.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14M5,3H19C20.11,3 21,3.89 21,5V13.03C20.5,12.23 19.81,11.54 19,11V5H5V19H9.5C9.81,19.75 10.26,20.42 10.81,21H5C3.89,21 3,20.11 3,19V5C3,3.89 3.89,3 5,3M7,7H17V9H7V7M7,11H12.03C11.23,11.5 10.54,12.19 10,13H7V11M7,15H9.17C9.06,15.5 9,16 9,16.5V17H7V15Z"></path></svg> Scan Vault'},n.onclick=()=>{this.matches=[],this.searchResults=[],this.manualSelections=[],this.selected.clear(),this.render()};let l=t.createEl("div",{cls:"pii-search-container"}),h=l.createEl("input",{type:"text",placeholder:"Search for text to encrypt...",cls:"pii-search-input"}),u=l.createEl("button",{cls:"pii-btn-primary"});u.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14Z"></path></svg> Search',u.onclick=async()=>{let E=h.value.trim();if(!E){new m.Notice("Please enter search text");return}u.disabled=!0,u.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"><animateTransform attributeName="transform" attributeType="XML" type="rotate" dur="1s" from="0 12 12" to="360 12 12" repeatCount="indefinite" /></path></svg> Searching...',this.searchResults=await this.searchVault(E),this.selected.clear(),this.render(),u.disabled=!1,u.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M15.5,12C18,12 20,14 20,16.5C20,17.38 19.75,18.21 19.31,18.9L22.39,22L21,23.39L17.88,20.32C17.19,20.75 16.37,21 15.5,21C13,21 11,19 11,16.5C11,14 13,12 15.5,12M15.5,14A2.5,2.5 0 0,0 13,16.5A2.5,2.5 0 0,0 15.5,19A2.5,2.5 0 0,0 18,16.5A2.5,2.5 0 0,0 15.5,14Z"></path></svg> Search'},h.addEventListener("keydown",E=>{E.key==="Enter"&&u.click()}),t.createEl("hr");let w=t.createEl("div",{cls:"pii-list"}),C=t.createEl("div",{cls:"pii-drop"});C.createEl("div",{cls:"pii-drop-icon",text:""}),C.createEl("div",{text:"Drag items here to encrypt"});let r=t.createEl("div",{cls:"pii-btn-bar-bottom"}),d=r.createEl("button",{cls:"pii-btn-primary pii-btn-half"});d.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z"></path></svg> Lock Selected',d.onclick=()=>this.lock();let y=r.createEl("button",{cls:"pii-btn-secondary pii-btn-half"});y.innerHTML='<svg viewBox="0 0 24 24" width="16" height="16"><path fill="currentColor" d="M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V10A2,2 0 0,1 6,8H15V6A3,3 0 0,0 12,3A3,3 0 0,0 9,6H7A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,17A2,2 0 0,0 14,15A2,2 0 0,0 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17Z"></path></svg> Unlock All',y.onclick=()=>this.unlock()}async onClose(){this.containerEl.empty(),this.cleanupTextSelectionDragDrop()}setupTextSelectionDragDrop(){document.addEventListener("mouseup",this.boundHandleTextSelection),document.addEventListener("dragstart",this.boundHandleDragStart)}cleanupTextSelectionDragDrop(){document.removeEventListener("mouseup",this.boundHandleTextSelection),document.removeEventListener("dragstart",this.boundHandleDragStart)}handleTextSelection(t){let e=window.getSelection();if(!e||e.rangeCount===0)return;let s=e.toString().trim();if(!s||!t.target.closest(".markdown-source-view, .cm-editor"))return;let i=e.getRangeAt(0);if(!i.collapsed)try{let n=document.createElement("span");n.draggable=!0,n.style.backgroundColor="var(--text-selection)",n.style.cursor="grab",n.title="Drag to encrypt this text",n.setAttribute("data-selected-text",s),i.surroundContents(n),setTimeout(()=>{if(n&&n.parentNode){let l=n.parentNode;for(;n.firstChild;)l.insertBefore(n.firstChild,n);l.removeChild(n)}},Q)}catch(n){console.error("Could not make selection draggable:",n)}}handleDragStart(t){let s=t.target.getAttribute("data-selected-text");s&&t.dataTransfer&&(t.dataTransfer.setData("text/plain",s),t.dataTransfer.setData("application/x-selected-text",s),t.dataTransfer.effectAllowed="copy")}async searchVault(t){let e=[],s=this.app.vault.getMarkdownFiles();for(let a of s){let i=(await this.app.vault.cachedRead(a)).split(`
`);for(let n=0;n<i.length;n++){let l=i[n],h=0;for(;(h=l.toLowerCase().indexOf(t.toLowerCase(),h))!==-1;){let u={text:l.substring(h,h+t.length),file:a,line:n,col:h};e.push(u),h+=t.length}}}return e}render(){let t=this.containerEl.querySelector(".pii-list"),e=this.containerEl.querySelector(".pii-drop"),s=this.containerEl.querySelector(".pii-search-container"),a=this.containerEl.querySelector(".pii-scan-controls"),o=this.containerEl.querySelector(".pii-mode-toggle");s&&(s.style.display=this.currentMode==="search"?"flex":"none"),a&&(a.style.display=this.currentMode==="scan"?"flex":"none"),t.empty(),e.empty(),e.createEl("div",{cls:"pii-drop-icon",text:"\u{1F512}"}),e.createEl("div",{text:"Drag items here to encrypt"});let i=this.currentMode==="scan"?this.matches:this.searchResults,n=this.currentMode==="scan"?"No sensitive information found":"No search results found";if(!i.length){t.createEl("div",{cls:"pii-empty"}),t.createEl("div",{cls:"pii-empty"}).innerHTML='<svg viewBox="0 0 24 24" width="32" height="32" style="opacity: 0.5"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,10.5A1.5,1.5 0 0,0 10.5,12A1.5,1.5 0 0,0 12,13.5A1.5,1.5 0 0,0 13.5,12A1.5,1.5 0 0,0 12,10.5M7.5,10.5A1.5,1.5 0 0,0 6,12A1.5,1.5 0 0,0 7.5,13.5A1.5,1.5 0 0,0 9,12A1.5,1.5 0 0,0 7.5,10.5M16.5,10.5A1.5,1.5 0 0,0 15,12A1.5,1.5 0 0,0 16.5,13.5A1.5,1.5 0 0,0 18,12A1.5,1.5 0 0,0 16.5,10.5Z"></path></svg>',t.createEl("p",{text:n});return}i.forEach((l,h)=>{let u=t.createEl("div",{cls:"pii-row"}),w=u.createEl("div",{cls:"pii-row-text",text:l.text});u.createEl("div",{cls:"pii-row-location",text:`${l.file.basename}:${l.line+1}`}),u.setAttr("draggable","true"),u.ondragstart=C=>{var r;return(r=C.dataTransfer)==null?void 0:r.setData("text/plain",String(h))},u.onclick=async()=>{var r;await this.app.workspace.getLeaf(!1).openFile(l.file),(r=this.app.workspace.getActiveViewOfType(m.MarkdownView))==null||r.editor.setCursor({line:l.line,ch:l.col})}}),e.ondragover=l=>{l.preventDefault(),e.addClass("hover")},e.ondragleave=()=>e.removeClass("hover"),e.ondrop=l=>{var w,C;l.preventDefault(),e.removeClass("hover");let h=(w=l.dataTransfer)==null?void 0:w.getData("application/x-selected-text");if(h){this.addManualSelection(h,e);return}let u=parseInt(((C=l.dataTransfer)==null?void 0:C.getData("text/plain"))||"-1");if(u>=0&&!this.selected.has(u)){this.selected.add(u);let r=e.createEl("div",{cls:"pii-tag"});r.textContent=i[u].text;let d=r.createEl("span",{cls:"pii-tag-remove",text:"\xD7"});d.style.marginLeft="4px",d.style.cursor="pointer",d.style.fontWeight="bold",d.onclick=y=>{y.stopPropagation(),this.selected.delete(u),r.remove()}}}}addManualSelection(t,e){let s=B();this.manualSelections.push({text:t,id:s});let a=e.createEl("div",{cls:"pii-tag pii-tag-manual"});a.textContent=t,a.setAttribute("data-manual-id",s);let o=a.createEl("span",{cls:"pii-tag-remove",text:"\xD7"});o.style.marginLeft="4px",o.style.cursor="pointer",o.style.fontWeight="bold",o.onclick=i=>{i.stopPropagation(),this.manualSelections=this.manualSelections.filter(n=>n.id!==s),a.remove()},new m.Notice(`Added "${t.substring(0,30)}${t.length>30?"...":""}" for encryption`)}async encryptManualSelection(t,e){let s=this.app.workspace.getActiveFile();if(!s)throw new Error("No active file to encrypt text in");let a=await this.app.vault.cachedRead(s),o=a.indexOf(t);if(o===-1){console.warn(`Text not found in active file: ${t.substring(0,50)}`),new m.Notice(`Text not found in active file: "${t.substring(0,30)}${t.length>30?"...":""}"`);return}let i=await $(t,e),n=`<details>
 <summary>Lock</summary>
 \xA7ENC_${B().slice(0,6)}_${i}\xA7
</details>`;a=a.substring(0,o)+n+a.substring(o+t.length),await this.app.vault.modify(s,a)}async getPassword(t=!1){if(this.cachedPassword)return this.cachedPassword;if(!t&&this.plugin.settings.storedPassword){let a=await new A(this.app,"Enter Your Password",!1).wait();if(a){let i=new TextEncoder().encode(a),n=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(n)).map(u=>u.toString(16).padStart(2,"0")).join("")===this.plugin.settings.storedPassword?(this.cachedPassword=a,a):(new m.Notice("Incorrect password"),null)}return null}let e=t?"Encrypt Sensitive Information":"Decrypt Protected Information",s=await new A(this.app,e,t).wait();if(s&&(this.cachedPassword=s,t&&!this.plugin.settings.storedPassword)){let o=new TextEncoder().encode(s),i=await crypto.subtle.digest("SHA-256",o),l=Array.from(new Uint8Array(i)).map(h=>h.toString(16).padStart(2,"0")).join("");this.plugin.settings.storedPassword=l,await this.plugin.saveSettings(),new m.Notice("Password saved for future use")}return s}clearCachedPassword(){this.cachedPassword=null}async lock(){let t=this.currentMode==="scan"?this.matches:this.searchResults;if(this.selected.size||t.forEach((o,i)=>this.selected.add(i)),!this.selected.size&&!this.manualSelections.length){new m.Notice("No items selected for encryption");return}let e=await this.getPassword(!0);if(!e)return;let s=this.selected.size+this.manualSelections.length,a=this.containerEl.createEl("div",{cls:"pii-status",text:`Encrypting ${s} item(s)...`});try{let o=0;for(let i of this.selected){let n=t[i],l=n.file,h=await this.app.vault.cachedRead(l),u=await $(n.text,e),w=`<details>
 <summary>Lock</summary>
 \xA7ENC_${B().slice(0,6)}_${u}\xA7
</details>`;h=h.replace(n.text,w),await this.app.vault.modify(l,h),o++}for(let i of this.manualSelections)await this.encryptManualSelection(i.text,e),o++;new m.Notice(`Successfully encrypted ${o} item(s)`),this.currentMode==="scan"?this.matches=[]:this.searchResults=[],this.selected.clear(),this.manualSelections=[],this.render()}catch(o){console.error("Encryption error:",o),new m.Notice("Error during encryption. Please try again.")}finally{a&&a.parentNode&&a.remove()}}async unlock(){let t=await this.getPassword(!1);if(!t)return;let e=/<details>\s*<summary>Lock<\/summary>\s*§ENC_[A-Za-z0-9]{6}_(.*?)§\s*<\/details>/g,s=this.containerEl.createEl("div",{cls:"pii-status",text:"Searching for encrypted content..."});try{let a=0,o=0,i=this.app.vault.getMarkdownFiles().length;for(let n of this.app.vault.getMarkdownFiles()){o++,s.textContent=`Processing files... (${o}/${i})`;let l=await this.app.vault.cachedRead(n),h=[],u;for(;(u=e.exec(l))!==null;)h.push({full:u[0],cipher:u[1]});if(h.length===0)continue;s.textContent=`Decrypting content in ${n.basename}...`;let w=!1;for(let C of h)try{let r=await _(C.cipher,t);l=l.replace(C.full,r),a++,w=!0}catch(r){console.error("Decryption failed:",r),this.cachedPassword&&(this.clearCachedPassword(),new m.Notice("Decryption failed. Password cache cleared."))}w&&await this.app.vault.modify(n,l)}a>0?(s.textContent=`Successfully decrypted ${a} item(s)`,s.addClass("pii-status-success"),new m.Notice(`Successfully decrypted ${a} item(s)`)):(s.textContent="No encrypted content found or incorrect password",new m.Notice("No encrypted content found or incorrect password"),this.clearCachedPassword()),setTimeout(()=>{s&&s.parentNode&&s.remove()},tt)}catch(a){console.error("Decryption error:",a),new m.Notice("Error during decryption. Please try again."),s&&s.parentNode&&s.remove()}}}});var rt={};U(rt,{default:()=>D});module.exports=X(rt);var K=require("obsidian");var v=require("obsidian"),Z={patterns:["\\d{6}-\\d{7}","\\d{3}-\\d{4}-\\d{4}"],patternMetadata:[{pattern:"\\d{6}-\\d{7}",source:"user",displayName:"User Pattern 1"},{pattern:"\\d{3}-\\d{4}-\\d{4}",source:"user",displayName:"User Pattern 2"}],encryptAlgo:"AES-GCM",storedPassword:void 0,defaultPatterns:"",selectedCountries:[]};async function et(p){try{let c=p.app.vault.adapter,e=`${p.manifest.dir||""}/default-patterns.ini`;return await c.read(e)}catch(c){return console.warn("Could not load default-patterns.ini, using empty patterns:",c),""}}function st(p){let c={},t=p.split(`
`),e="",s={US:"United States",Korea:"South Korea",Japan:"Japan",Taiwan:"Taiwan",India:"India",None:"No Default Pattern"};for(let a of t){let o=a.trim();if(o){if(o.startsWith("[")&&o.endsWith("]"))e=o.slice(1,-1),c[e]={displayName:s[e]||e,name:"",address:"",phone:""};else if(e&&o.includes("=")){let[i,...n]=o.split("="),l=n.join("=");i==="name"?c[e].name=l:i==="address"?c[e].address=l:i==="phone"&&(c[e].phone=l)}}}return c}function nt(p){let c="";for(let[t,e]of Object.entries(p))c+=`[${t}]
`,c+=`name=${e.name}
`,c+=`address=${e.address}
`,c+=`phone=${e.phone}
`,Object.keys(p).indexOf(t)<Object.keys(p).length-1&&(c+=`
`);return c}async function it(p,c){try{let t=p.app.vault.adapter,s=`${p.manifest.dir||""}/default-patterns.ini`;await t.write(s,c)}catch(t){console.error("Could not save default-patterns.ini:",t),new v.Notice("Failed to save default patterns file")}}async function at(p,c,t,e,s){if(e!=="user"){let a=s[e];if(a){let o=!1;if(a.name){let i=a.name.split("|").filter(l=>l.trim()),n=i.indexOf(c);n!==-1&&(i[n]=t,a.name=i.join("|"),o=!0)}if(!o&&a.address){let i=a.address.split("|").filter(l=>l.trim()),n=i.indexOf(c);n!==-1&&(i[n]=t,a.address=i.join("|"),o=!0)}if(!o&&a.phone){let i=a.phone.split("|").filter(l=>l.trim()),n=i.indexOf(c);n!==-1&&(i[n]=t,a.phone=i.join("|"),o=!0)}if(o){let i=nt(s);await it(p,i)}}}}var T=class extends v.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}async handlePasswordChange(){let{PwModal:t}=await Promise.resolve().then(()=>(R(),j)),s=await new t(this.app,"Set Encryption Password",!0).wait();if(s){let o=new TextEncoder().encode(s),i=await crypto.subtle.digest("SHA-256",o),l=Array.from(new Uint8Array(i)).map(h=>h.toString(16).padStart(2,"0")).join("");this.plugin.settings.storedPassword=l,await this.plugin.saveSettings(),new v.Notice("Password saved successfully")}}display(){let{containerEl:t}=this;t.empty(),this.renderContent()}async renderContent(){let{containerEl:t}=this;t.addClass("pii-settings-container");let e=t.createEl("details");e.createEl("summary",{text:"Manage Patterns",cls:"pii-collapsible-header"});let s=e.createDiv("pii-patterns-container"),a=await et(this.plugin),o=st(a);if(!this.plugin.settings.patternMetadata){this.plugin.settings.patternMetadata=[];let r=1;for(let d of this.plugin.settings.patterns)this.plugin.settings.patternMetadata.push({pattern:d,source:"user",displayName:`User Pattern ${r}`}),r++;await this.plugin.saveSettings()}this.plugin.settings.patternMetadata.forEach((r,d)=>{let y=new v.Setting(s).setName(r.displayName).addText(E=>E.setPlaceholder("\\d{6}-...").setValue(r.pattern).onChange(async x=>{let g=r.pattern;this.plugin.settings.patterns[d]=x,this.plugin.settings.patternMetadata[d].pattern=x,await at(this.plugin,g,x,r.source,o),await this.plugin.saveSettings()})).addExtraButton(E=>E.setIcon("trash").setTooltip("remove").onClick(async()=>{this.plugin.settings.patterns.splice(d,1),this.plugin.settings.patternMetadata.splice(d,1),r.source!=="user"&&this.plugin.settings.patternMetadata.filter(g=>g.source===r.source).length===0&&(this.plugin.settings.selectedCountries=this.plugin.settings.selectedCountries.filter(g=>g!==r.source)),await this.plugin.saveSettings(),this.display()}));if(this.plugin.settings.patterns.length===1){let E=y.controlEl.querySelector("button");E&&(E.disabled=!0)}}),new v.Setting(s).addButton(r=>r.setButtonText("+").setTooltip("Add pattern").setCta().onClick(async()=>{let d=this.plugin.settings.patternMetadata.filter(y=>y.source==="user").length+1;this.plugin.settings.patterns.push(""),this.plugin.settings.patternMetadata.push({pattern:"",source:"user",displayName:`User Pattern ${d}`}),await this.plugin.saveSettings(),this.display()})),t.createEl("hr"),t.createEl("h3",{text:"Default Patterns"});let i=Object.keys(o).filter(r=>r!=="None"),n=this.plugin.settings.selectedCountries,l=n.map(r=>{var d;return((d=o[r])==null?void 0:d.displayName)||r}).join(", ");new v.Setting(t).setName("Selected Countries").setDesc(n.length>0?l:"No countries selected").addButton(r=>r.setButtonText("Clear All").onClick(async()=>{this.plugin.settings.selectedCountries=[];let d=this.plugin.settings.patternMetadata.filter(y=>y.source==="user");this.plugin.settings.patterns=d.map(y=>y.pattern),this.plugin.settings.patternMetadata=d,await this.plugin.saveSettings(),new v.Notice("Cleared all selected countries"),this.display()})),t.createEl("h4",{text:"Add Country Patterns"});let h=t.createDiv("pii-country-buttons");i.forEach(r=>{let d=o[r],y=this.plugin.settings.selectedCountries.includes(r);new v.Setting(h).setName(d.displayName).setDesc(`Add patterns for ${d.displayName}`).addButton(E=>E.setButtonText(y?"Remove":"Add").setClass(y?"mod-warning":"mod-cta").onClick(async()=>{if(this.plugin.settings.selectedCountries.includes(r)){this.plugin.settings.selectedCountries=this.plugin.settings.selectedCountries.filter(f=>f!==r);let g=[];if(d.name){let f=d.name.split("|").filter(P=>P.trim());g.push(...f)}if(d.address){let f=d.address.split("|").filter(P=>P.trim());g.push(...f)}if(d.phone){let f=d.phone.split("|").filter(P=>P.trim());g.push(...f)}this.plugin.settings.patterns=this.plugin.settings.patterns.filter(f=>!g.includes(f)),this.plugin.settings.patternMetadata=this.plugin.settings.patternMetadata.filter(f=>f.source!==r),new v.Notice(`Removed ${d.displayName} patterns`)}else{if(!this.plugin.settings.selectedCountries.includes(r))this.plugin.settings.selectedCountries.push(r);else{new v.Notice(`${d.displayName} is already selected`);return}if(d.name){let g=d.name.split("|").filter(f=>f.trim());this.plugin.settings.patterns=[...this.plugin.settings.patterns,...g],g.forEach((f,P)=>{this.plugin.settings.patternMetadata.push({pattern:f,source:r,displayName:`${r} Name ${P+1}`})})}if(d.address){let g=d.address.split("|").filter(f=>f.trim());this.plugin.settings.patterns=[...this.plugin.settings.patterns,...g],g.forEach((f,P)=>{this.plugin.settings.patternMetadata.push({pattern:f,source:r,displayName:`${r} Address ${P+1}`})})}if(d.phone){let g=d.phone.split("|").filter(f=>f.trim());this.plugin.settings.patterns=[...this.plugin.settings.patterns,...g],g.forEach((f,P)=>{this.plugin.settings.patternMetadata.push({pattern:f,source:r,displayName:`${r} Phone ${P+1}`})})}new v.Notice(`Added ${d.displayName} patterns`)}await this.plugin.saveSettings(),this.display()}))}),t.createEl("hr"),t.createEl("h3",{text:"Password Management"});let u=!!this.plugin.settings.storedPassword,w=u?"Password is currently stored":"No password stored",C=t.createEl("p",{text:w,cls:u?"pii-password-status-active":"pii-password-status-inactive"});new v.Setting(t).setName(u?"Change Password":"Set Password").setDesc(u?"Update your encryption password":"Set a password for encryption operations").addButton(r=>r.setButtonText(u?"Change":"Set").setCta().onClick(async()=>{await this.handlePasswordChange(),this.display()})),u&&new v.Setting(t).setName("Clear Stored Password").setDesc("Remove the stored password. You will be prompted for password on each operation.").addButton(r=>r.setButtonText("Clear").setWarning().onClick(async()=>{this.plugin.settings.storedPassword=void 0,await this.plugin.saveSettings(),new v.Notice("Password cleared successfully"),this.display()}))}};V();var H=require("obsidian"),L=class extends H.Modal{constructor(t,e){super(t);this.matches=e}onOpen(){let{contentEl:t}=this;if(t.empty(),t.addClass("pii-modal"),t.createEl("h3",{text:`PII\xA0Matches (${this.matches.length})`}),!this.matches.length){t.createEl("p",{text:"No PII found \u{1F389}"});return}let e=t.createEl("div",{cls:"pii-list"});this.matches.forEach((s,a)=>{let o=e.createEl("div",{cls:"pii-item"}),i=o.createEl("input",{type:"checkbox"});i.checked=!0,o.createEl("span",{text:`${s.text}  \u2014  ${s.file.basename}:${s.line+1}`,cls:"pii-text"});let n=o.createEl("button",{text:"Open"});n.onclick=()=>this.openAtPosition(s)}),t.createEl("button",{text:"Close",cls:"mod-cta"}).onclick=()=>this.close()}async openAtPosition(t){await this.app.workspace.getLeaf(!1).openFile(t.file);let s=this.app.workspace.getActiveViewOfType(H.MarkdownView);s&&s.editor.setCursor({line:t.line,ch:t.col})}onClose(){this.contentEl.empty()}};function G(p){p.addCommand({id:"pii-scan",name:"PII\xA0Scan",callback:async()=>{let c=await k(p);new L(p.app,c).open()}}),p.addCommand({id:"pii-lock",name:"PII\xA0Lock (encrypt)",callback:()=>{}}),p.addCommand({id:"pii-unlock",name:"PII\xA0Unlock (decrypt)",callback:()=>{}})}R();var D=class extends K.Plugin{async onload(){await this.loadSettings(),this.registerView(b,t=>new S(t,this)),this.addRibbonIcon("shield","Lock and Find",()=>this.activateSidebar()),this.addSettingTab(new T(this.app,this)),G(this)}onunload(){this.app.workspace.detachLeavesOfType(b)}async activateSidebar(){let t=this.app.workspace.getLeavesOfType(b);if(t.length>0){this.app.workspace.revealLeaf(t[0]);return}let e=this.app.workspace.getLeftLeaf(!1);await e.setViewState({type:b,active:!0}),this.app.workspace.revealLeaf(e)}async loadSettings(){let t=await this.loadData();this.settings={...Z,...t}}async saveSettings(){await this.saveData(this.settings)}};
